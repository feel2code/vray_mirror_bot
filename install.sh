#!/usr/bin/env bash

set -euo pipefail

REPO_DIR="vray_mirror_bot"
URL="https://github.com/feel2code/vray_mirror_bot.git"

echo "üöÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º vray_mirror_bot..."

if ! command -v git &> /dev/null; then
    echo "‚ùå Git –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ git –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ." >&2
    exit 1
fi

if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ python3 –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ." >&2
    exit 1
fi

if [ -d "$REPO_DIR" ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é $REPO_DIR"
    rm -rf "$REPO_DIR"
fi

echo "üì• –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
git clone "$URL" "$REPO_DIR"
cd "$REPO_DIR"
echo "üêç –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
python3 -m venv venv
source venv/bin/activate
echo "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º pip..."
pip install --upgrade pip
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
pip install -r requirements.txt
echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "-----------------------"
echo "üìÇ –ü—Ä–æ–µ–∫—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $PWD"
echo "üîß –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: source venv/bin/activate"
echo "üêç –ò –∑–∞–ø—É—Å—Ç–∏—Ç–µ: python main.py"
